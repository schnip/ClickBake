jQuery&&function($){function videoPage(options){this.settings=$.extend(!0,{},defaults,options||{}),this.playlists={},this.init()}FD.loadCSS({rel:"stylesheet",href:SNI.Config.Video.playerUrl.css,type:"text/css",media:"screen"},"head"),FD.Video||(FD.Video={}),FD.Video.Config||(FD.Video.Config={player:{autoplay:!1,logLevel:"fatal",containerId:"fd-player",skinUrl:SNI.Config.Video.playerUrl.skin,layoutUrl:SNI.Config.Video.playerUrl.layout},social:{enabled:!1},playClickToggle:{enabled:!1},endframe:{endframeCountdown:4}});var defaults={selector:{videoPlayer:".fd-video-player",playlists:".fd-playlists"}};videoPage.prototype.init=function(){var self=this,settings=self.settings;self.container=settings.container,self.initPlayer()},videoPage.prototype.initPlayer=function(){var self=this,settings=self.settings,selector=settings.selector;self.container.find(selector.videoPlayer).each(function(){$(this);self.player=new FD.Video.SniPlayer(settings)})},videoPage.prototype.initPlaylists=function(){var self=this,settings=self.settings,selector=settings.selector;self.container.find(selector.playlist).each(function(){var container=$(this),id=(self.player,container.attr("id")),playlist=new FD.Video.Playlist(container,{video:settings.video,videoPlayer:self.player});self.playlists[id]=playlist})},FD.Video.VideoPage=videoPage}(jQuery),function($){function VideoPlayer(options){var self=this;self.settings=$.extend(!0,{},defaults,options),self.playerId=self.settings.video.player.containerId;var events=self.settings.events;$.each(events,function(key,val){val.startsWith("fd.")&&(events[key]=val+"_"+self.playerId)}),self.init()}"undefined"==typeof FD.Video&&(FD.Video={}),FD.Video.Config||(FD.Video.Config={player:{autoplay:!1,logLevel:"fatal",containerId:"fd-player",skinUrl:SNI.Config.Video.playerUrl.skin,layoutUrl:SNI.Config.Video.playerUrl.layout},social:{enabled:!1},playClickToggle:!1,endframe:{endframeCountdown:4}});var defaults={events:{onReady:"fd.videplayer.ready",onReset:"fd.videoplayer.reset",onLoad:"OnLoadReleaseUrl",onSet:"OnSetReleaseUrl"},video:FD.Video.Config};VideoPlayer.prototype.checkPlayer=function(){var self=this;return self.sniPlayer?!0:(self.sniPlayer=new SNI.Video.Player(self.settings.video),$("#"+self.playerId).data("videoPlayer",self.sniPlayer),FD.publish(self.settings.events.onReady,[self]),!1)},VideoPlayer.prototype.init=function(){var self=this;self.settings;self.controller=$pdk.controller},VideoPlayer.prototype.reset=function(videoModal){var self=this;$(document.getElementById(self.playerId)).empty(),delete SNI.Video.Players[self.settings.video.player.containerId],FD.publish(self.settings.events.onReset,[self])},VideoPlayer.prototype.stop=function(){var self=this,player=self.sniPlayer;self.controller.pause(!0,[self.playerId]),player.modules&&player.modules.endframe&&player.modules.endframe.resetCountdown()},VideoPlayer.prototype.onReady=function(fn){var self=this,onReadyFn=fn;return FD.subscribe(this.settings.events.onReady,function(){onReadyFn(self)}),this},VideoPlayer.prototype.onReset=function(fn){return FD.subscribe(this.settings.events.onReset,fn),this},VideoPlayer.prototype.onLoad=function(fn){return this.sniPlayer.subscribe(this.settings.events.onLoad,fn,this.playerId),this},VideoPlayer.prototype.onSet=function(fn){return this.sniPlayer.subscribe(this.settings.events.onSet,fn,this.playerId),this},FD.Video.SniPlayer=VideoPlayer}(jQuery),function($){function Playlist($container,options){return this.container=$container,this.settings=$.extend(!0,{},defaults,{video:FD.Video.Config},options),this.playerId=$container&&$container.data("videoPlayerId")||this.settings.video.player.containerId,this.playerId&&$("#"+this.playerId).length?(this.id=this.getId(),this.containerId=$container.attr("id")||this.playerId+"_playlist_"+this.id,this.settings.video.channels?void this.init():void(this.state="ERROR: no channel data")):(this.state="ERROR: no video player object",!1)}"undefined"==typeof FD.Video&&(FD.Video={});var defaults={template:{playlistContainer:'<section class="fd-static fd-vidmod-playlist-container fd-container"></section>',playlist:'<section id="{{=it.id}}-vidmod-playlist" class="fd-vidmod-playlist"></section>',playlistItem:'<div id="{{=it.parentId}}_{{=it.cmsid}}" class="fd-thumb fd-thumb-video-molecule"><div class="fd-img-wrap fd-thumb-video"><div class="inner-wrapper"><div class="img-overlay">&nbsp;</div><img data-src="{{=it.imageUrl854x480}}" alt="{{=it.title}}"></div><div class="fd-play-icon"><i class="icon-fdc-play"></i></div></div><div class="fd-thumb-details"><h4 class="fd-thumb-title">{{=it.title}} <span class="fd-video-length">({{=it.duration}})</span></h4><a class="fd-show-more" href="#">More</a><div class="fd-thumb-description"><p>{{=it.description}}</p><div class="fd-site-tools"><dl class="util"><dt class="share-networks"><a class="social-share" data-network="pinterest" data-video-share="true" title="Share on Pinterest"><i class="icon-fdc-pinterest"></i></a> <a class="social-share" data-network="facebook" data-video-share="true" title="Share on Facebook"><i class="icon-fdc-facebook"></i></a> <a class="social-share" data-network="twitter" data-video-share="true" title="Share on Twitter"><i class="icon-fdc-twitter"></i></a> <a class="social-share" data-network="gplus" data-video-share="true" title="Share on Google+"><i class="icon-fdc-google"></i></a> </dt></dl></div></div></div></div>',playlistItemAlt:'<div id="{{=it.parentId}}_{{=it.cmsid}}" class="fd-thumb-horizontal fd-thumb-video-molecule"><div class="fd-img-wrap fd-thumb-video"><div class="inner-wrapper"><div class="img-overlay">&nbsp;</div><img data-src="{{=it.imageUrl854x480}}" alt="{{=it.title}}"></div><div class="fd-play-icon"><i class="icon-fdc-play"></i></div></div><div class="fd-thumb-details"><h4 class="fd-thumb-title">{{=it.title}}</h4><h5 class="fd-video-length">({{=it.duration}})</h5></div></div>',button:'<button type="button" class="btn btn-default {{=it.css}}">{{=it.text}}</button>'},selector:{breadcrumb:".active-breadcrumb-title",heading:".fd-page-header h1",playlist:{container:".fd-vidmod-playlist-container",containerId:null,dropdown:".fd-playlist-dropdown .fd-dropdown__select",thumb:{container:".fd-thumb-video-molecule",description:".fd-thumb-description"},button:{more:".fd-show-more",moreThumbs:".btn-see-more-videos",all:".btn-see-all-videos"}},video:{active:{title:".fd-active-video-title",length:".fd-active-video-info .fd-video-length",description:".fd-active-video-description"}}},data:{button:{more:{css:"fd-show-more",text:"More"},moreThumbs:{css:"btn-see-more-videos",text:"More"},all:{css:"btn-see-more-videos",text:"See All Videos"}}},events:{videoLoaded:"fd.video.library.loaded",playListAdded:"fd.video.playlist.added",currentVideoChanged:"fd.video.playlist.currentvideochanged",api:{player:{onLoad:"OnLoadReleaseUrl",onSet:"OnSetReleaseUrl"}}}};Playlist.prototype.getId=function(){var self=this,id=self.container.attr("id");if(id){var idSplit=id.split("-"),len=idSplit.length;len>4&&(id=idSplit[len-1])}else id=FD.Page.getUniqueId();return id},Playlist.prototype.init=function(){var self=this,settings=self.settings,template=settings.template;self.render={},self.player=settings.videoPlayer,$.each(template,function(name,value){self.render[name]=doT.template(value)}),$(function(){self.playerContainer=$("#"+self.playerId),self.renderTemplates(),self.setUpDomEvents(),self.setUpPlayerEvents(),FD.scrollTracker&&FD.subscribe(FD.scrollTracker.eventName,function(){self.lazyLoadThumbnails()})})},Playlist.prototype.renderTemplates=function(){var $playlistElement,$playlistItemElement,self=this,settings=this.settings,selector=settings.selector,playlist=selector.playlist,video=selector.video,activeVideo=video.active,pageType=FD.Page.type;self.elements={activeVideo:{title:$(activeVideo.title),length:$(activeVideo.length),description:$(activeVideo.description)},playlist:$("#"+self.player.settings.id).find(playlist.container).not('[data-module="recipePageTopVideos"] '+playlist.container)},("PLAYLIST"===pageType||"VIDEO"===pageType||"PLAYLIST-VIDEO"===pageType)&&(self.elements.page={heading:$(selector.heading),playlistDropdown:$(playlist.dropdown)}),self.elements.playlist&&$.each(self.settings.video.channels,function(channelIndex,channelItem){var channelId=channelItem.id;$playlistElement=$(self.render.playlist(channelItem)),$playlistElement.attr("data-index",channelIndex),$.each(channelItem.videos,function(videoIndex,videoItem){videoItem.parentId=channelId,$playlistItemElement=$(self.render.playlistItem(videoItem)),$playlistItemElement.attr("data-index",videoIndex),$playlistItemElement.attr("data-channel",channelIndex),$playlistElement.append($playlistItemElement)}),$playlistElement.append($(self.render.button(settings.data.button.moreThumbs))),self.elements.playlist.append($playlistElement),FD.publish(self.settings.events.playListAdded,[{playlistContainer:self.elements.playlist}])})},Playlist.prototype.setUpDomEvents=function(){var self=this,settings=this.settings,selector=settings.selector,playlist=selector.playlist,thumb=playlist.thumb,button=playlist.button,context=selector.playlist.container+" ",$playlistDropdown=self.elements.page&&self.elements.page.playlistDropdown;$(document).on("click",context+thumb.container,function(e){var target=$(e.target),noModal=target.data("noModal");return noModal?!1:void(0==$(target).parents("#top-videos-module").length&&self.loadNewVideo($(this).data("channel"),$(this).data("index")))}),$(document).on("click",context+button.more,function(event){event.preventDefault(),$(this).fadeOut("slow"),$(this).siblings(selector).slideDown("slow"),event.stopPropagation()}),$(document).on("click",context+button.moreThumbs,function(){$(this).siblings(thumb.container).fadeIn(),$(this).hide()}),$(document).on("click",button.all,function(){window.location.href=$(this).data("base-url")+"/video"}),$playlistDropdown&&$playlistDropdown.on("change",function(event){event.preventDefault(),window.location.href=$(this).val()})},Playlist.prototype.setUpPlayerEvents=function(){var self=this,updateVideoPanel=(self.settings.events.api.player,self.updateVideoPanel.bind(self)),highlightActiveVideo=self.highlightActiveVideo.bind(self),updateBreadcrumb=self.updateBreadcrumb.bind(self);self.player.onReady(function(){self.player.onLoad(updateVideoPanel).onSet(updateVideoPanel).onLoad(highlightActiveVideo).onSet(highlightActiveVideo),"VIDEO"===FD.Page.type&&self.player.onLoad(updateBreadcrumb).onSet(updateBreadcrumb)})},Playlist.prototype.updateVideoPanel=function(){var self=this,settings=this.settings,selector=settings.selector,video=(selector.playlist,selector.video),activeVideo=video.active,sniPlayer=self.player.sniPlayer;if(self.player&&sniPlayer.currentVideo){var currentVideo=sniPlayer.currentVideo,videoLength=currentVideo.duration,$fdActiveVideoTitle=$(activeVideo.title),$fdActiveVideoLength=$(activeVideo.length),$fdActiveVideoDescription=$(activeVideo.description);$fdActiveVideoTitle.text(currentVideo.title),$fdActiveVideoLength.html("("+videoLength+")"),$fdActiveVideoDescription.html(currentVideo.description),FD.publish(self.settings.events.currentVideoChanged,[self]);var pageUrl=new FD.Url,vidUrl=new FD.Url(currentVideo.seoUrl),pageType=FD.Page.type;("PLAYLIST"===pageType||"VIDEO"===pageType||"PLAYLIST-VIDEO"===pageType)&&($.extend(!0,vidUrl.querystring.data,pageUrl.querystring.data||{}),FD.History.replace({},FD.Page.title(),vidUrl.toString()))}},Playlist.prototype.updateBreadcrumb=function(){var self=this;$(self.settings.selector.breadcrumb).text(self.player.sniPlayer.currentVideo.title)},Playlist.prototype.highlightActiveVideo=function(){var self=this,currentVideo=self.player.sniPlayer.currentVideo,$currentThumbnail=$("#"+currentVideo.parentId+"_"+currentVideo.cmsid);$(".now-playing").removeClass("now-playing"),$currentThumbnail.addClass("now-playing"),$currentThumbnail.is(":visible")||$currentThumbnail.siblings(".btn-see-more-videos").trigger("click")},Playlist.prototype.loadNewVideo=function(channelIndex,videoIndex){function go(){var sniPlayer=self.player.sniPlayer;self.player.previousVideo=self.player.currentVideo,$pdk.controller.hidePlayerCard("forms",null,[sniPlayer.pdk.scopes]),sniPlayer.setCurrentChannel(channelIndex),self.player.currentVideo=sniPlayer.currentVideo,self.updateVideoPanel(),sniPlayer.isReady()?sniPlayer.play(videoIndex):sniPlayer.subscribe("PlayerReady",function(){sniPlayer.play(videoIndex)}),$pdk.controller.pause(!1,[sniPlayer.pdk.scopes])}var self=this;self.player.checkPlayer()?go():setTimeout(go,1e3)},Playlist.prototype.lazyLoadThumbnails=function(offset){var self=this,pageHeight=(self.settings.selector,FD.Page.viewport().height),scrollOffset=offset||300,topPos=$(".fd-vidmod-playlist-container").offset().top;$(".fd-thumb-video img[data-src]:not(img[src])").each(function(){var img=$(this),scrollPos=$(window).scrollTop(),scrollPosWithOutset=scrollPos+scrollOffset,src=img.attr("data-src");FD.subscribe("fd.lazyload.error",function(){var args=arguments;args.length&&args[0]&&args[0].length&&args[0].remove()}),img.on("error",function(){log(img)}),(pageHeight>topPos-scrollPosWithOutset&&topPos-scrollPosWithOutset>=0||pageHeight>topPos-(scrollPos-200)&&topPos-(scrollPos-200)>=0||scrollPos>topPos)&&(log("lazy load img ("+scrollOffset+"): "+src),img.attr("src",src))})},FD.Video.Playlist=Playlist}(jQuery),"undefined"!=typeof jQuery&&function($){function RelatedVideos(options){var self=this;self.settings=$.extend(!0,defaults,options||{}),self.render={component:{}},self.createTemplates(),self.page={},self.firstClick=!0,self.addSubscribers()}FD.loadCSS({rel:"stylesheet",href:SNI.Config.Video.playerUrl.css,type:"text/css",media:"screen"},"head");var defaults={selector:{videoPlayer:".fd-video-player",playlist:".fd-vidmod-playlist-container",video:{module:".inline-video"},howTo:".cta"},events:{data:{error:"related.video.data.error",loaded:"related.video.data.loaded"},register:{complete:"related.video.page.register.complete",error:"related.video.page.register.error"},component:{video:"related.video.container.loaded",playlist:"related.video.playlist.container.loaded",howtoCTA:"related.video.howtocta.loaded",relatedVideosPlaylist:"related.video.relatedvideosplaylist.loaded"}},component:[{name:"video",target:".jumbotron",insert:"after",selector:".inline-video",template:'<section class="fd-video-page inline-video clearfix fd-video-contextual" style="height: 1px; overflow: hidden;"><div class="fd-active-video-container fd-container"><div class="close-container"><button class="text-close">Close</button></div><div class="fd-active-video" content="PLAYER PLACEHOLDER"><div class="inner-wrapper"><div class="fd-video-player"></div></div></div><div class="fd-active-video-info clearfix" itemprop="video" itemscope itemtype="http://schema.org/VideoObject"><meta itemprop="name" content="" /><meta itemprop="duration" content="" /><meta itemprop="thumbnail" content="" /><meta itemprop="contentURL" content="" /><h1><span class="fd-active-video-title"></span><span class="fd-video-length">()</span></h1><p itemprop="description" class="fd-active-video-description"></p></div><div id="bigbox" class="fd-video-ad"></div><a class="fd-playlist-more-link" href="http://www.food.com/video">More Videos</a></div></section>'},{name:"playlist",target:".fd-video-ad",insert:"after",selector:".inline-video .fd-vidmod-playlist-container",template:'<section class="fd-static fd-vidmod-playlist-container" data-tile-limit="5"></section>'},{name:"howtoCTA",target:".directions h3",insert:"after",selector:".directions .video-howto-link",template:'<div class="cta"><a href="#" class="related-video-howto"><i class="icon-fdc-play"></i><span class="btn-text">Watch how to make this recipe</span></a></div>'},{name:"relatedVideosPlaylist",target:".directions ol",insert:"after",selector:".directions .fd-vidmod-playlist-container",template:'<section class="fd-static fd-vidmod-playlist-container" data-tile-limit="2"><h4 class="text-left">Up Next</h4></section>'}],url:{data:FD.Config.apiServerURL+"/services/mobile/videos/context/recipe"},querystring:{id:"recipeId"},playlist:[{name:"howtoCTA",target:".directions h3",insert:"after",selector:".directions .video-howto-link",template:'<div class="cta"><a href="#" class="related-video-howto"><i class="icon-fdc-play"></i><span class="btn-text">Watch how to make this recipe</span></a></div>'},{name:"relatedVideosPlaylist",target:".directions ol",insert:"after",selector:".directions .fd-vidmod-playlist-container",template:'<section class="fd-static fd-vidmod-playlist-container" data-tile-limit="2"></section>'}]};RelatedVideos.prototype.message={publish:FD.publish,subscribe:FD.subscribe},RelatedVideos.prototype.register=function(element){function isIdAttribute(name){var lname=name.toLowerCase();return lname.contains("id")}function checkElementData($element){for(var attr in $element.data())if(isIdAttribute(attr))return id=$element.data(attr),1;return 0}var self=this,$element=(self.settings,element.jquery?element:$(element)),id=$element.attr("id");id||checkElementData($element)||(id=FD.Page.getUniqueId(),$element.attr("id",id)),self.page[id]={id:id,container:$element},self.setData(id)},RelatedVideos.prototype.setData=function(id){var self=this,settings=self.settings,dataUrl=settings.url.data,ajaxOptions={url:dataUrl,type:"get",dataType:"json",data:{}};$.ajax.debounce(500,!0);ajaxOptions.data[settings.querystring.id]=id,$.ajax(ajaxOptions).done(function(response,status,jqxhr){var page=self.page[id];page.data=response,response.error?self.message.publish("fd.relatedvideos.error",[response,ajaxOptions]):(self.message.publish("fd.relatedvideos.dataloaded",[response]),response.channels[0].videos.length&&self.loadComponents(id))})},RelatedVideos.prototype.createTemplates=function(){var self=this,settings=self.settings,component=settings.component;component.forEach(function(cfg){self.render.component[cfg.name]=doT.template(cfg.template)})},RelatedVideos.prototype.getHowToVideoIdx=function(id){var self=this,page=self.page[id],channel=page.data&&page.data.channels&&page.data.channels[0],howToId=channel&&"undefined"!=typeof channel.howToVideoId&&channel.howToVideoId,videos=channel&&channel.videos;return videos.findIndex(function(vid,idx,arr){return vid.cmsid==howToId})},RelatedVideos.prototype.hasRelatedVideos=function(id){var self=this,page=self.page[id],channels=page.data.channels,result=!1;return channels.forEach(function(channel,idx,arr){var howToVideoId=channel.howToVideoId,videos=channel.videos;(videos.length>0&&!howToVideoId||howToVideoId&&videos.length>1)&&(result=!0)}),result},RelatedVideos.prototype.loadComponents=function(id){var self=this,page=self.page[id],settings=self.settings,events=(settings.selector,settings.events),component=settings.component,render=self.render.component,howTo="howtoCTA",relatedPlaylist="relatedVideosPlaylist",howToIdx=self.getHowToVideoIdx(id);page&&page.data&&!page.data.error&&component.forEach(function(cfg,idx,arr){var markup=render[cfg.name](cfg),target=page.container.find(cfg.target),loadComponent=!0;switch(cfg.name){case relatedPlaylist:loadComponent=self.hasRelatedVideos(id);break;case howTo:loadComponent=howToIdx!==!1&&howToIdx>-1}target.length&&loadComponent&&(target[cfg.insert](markup),self.message.publish(events.component[cfg.name],[id,cfg]))})},RelatedVideos.prototype.addSubscribers=function(){var self=this,settings=self.settings,selector=settings.selector;self.message.subscribe(self.settings.events.component.video,function(id,cfg){var playerId,$video,$player,settings=self.settings,selector=settings.selector,page=self.page[id];$video=page.container.find(cfg.selector),$player=$video.find(selector.videoPlayer),$video&&$player.length&&!page.videoManager&&(page.videoOptions={id:id,selector:selector,video:$.extend(!0,{},FD.Video.Config,page.data),container:$('article[data-recipe-id="'+id+'"] '+selector.video.module)},page.videoOptions.video.player.autoplay=page.data.autoplay,playerId=page.videoOptions.video.player.containerId="{0}_{1}_{2}".format(FD.Video.Config.player.containerId,id,FD.Page.getUniqueId()),page.container.find(selector.videoPlayer).attr("id",playerId),page.videoManager=new FD.Video.VideoPage(page.videoOptions),page.container.on("click",".icon-fdc-close, .text-close",function(e){e.preventDefault(),self.closeModule(page)}))}),self.message.subscribe(self.settings.events.component.playlist,function(id,cfg){var page=(FD.Page.Video.manager,self.page[id]),$playlist=page.container.find(cfg.selector);$playlist.each(function(){var $pl=$(this),playlistId=selector.playlist.Trim(/\./g)+"-{0}-{1}".format(id,FD.Page.getUniqueId());$pl.attr("id",playlistId)}),page.playlist=page.videoManager.initPlaylists(page.videoOptions),self.message.publish("fd.video.module.playlist-added",[id])}),self.message.subscribe(self.settings.events.component.howtoCTA,function(id){var page=self.page[id],container=page.container,howToSelector="a.related-video-howto";playlistId=container.find(".inline-video .fd-vidmod-playlist-container").attr("id"),container.find(howToSelector).attr("data-channel",0).attr("data-index",self.getHowToVideoIdx(id)),container.on("click","a.related-video-howto",function(e){e.preventDefault(),self.startStopVideo(e,page)})}),self.message.subscribe(self.settings.events.component.relatedVideosPlaylist,function(id){var page=self.page[id],channel=(page.container,page.data.channels[0]);if(channel){self.renderRelatedPlaylist(id);var videos=channel.videos.slice(),howToIdx=self.getHowToVideoIdx(id);self.playlist={},self.playlist.all=channel.videos,howToIdx>-1&&(self.playlist.howtoCTA=videos.splice(howToIdx,1)),self.playlist.relatedVideosPlaylist=videos}})},RelatedVideos.prototype.renderRelatedPlaylist=function(id){var playlist,thumbs,self=this,page=self.page[id],selector=self.settings.selector,playlist=page.container.find(".inline-video "+selector.playlist),clone=playlist.find(".fd-vidmod-playlist").clone(!0),howToSelector=selector.howTo,directions=page.container.find(".directions"),channel=page.data.channels[0],videos=channel.videos,howToVideoId=page.data.channels[0].howToVideoId;clone.find(howToSelector).remove(),playlist=clone.find(".fd-vidmod-playlist"),playlist.attr("id",playlist.attr("id")+"_related_playlist"),thumbs=clone.find(".fd-thumb-video-molecule").addClass("fd-thumb-horizontal"),thumbs.each(function(i,v){var thumb=$(this),$fdVideoLength=thumb.find(".fd-video-length"),$fdThumbDetails=thumb.find(".fd-thumb-details"),newVideoLength='<h5 class="fd-video-length"></h5>',videoLength=$fdVideoLength.html(),thumbId=thumb.attr("id"),videoIndex=thumb.data("index"),vId=videos[videoIndex].cmsid;i>1||vId==howToVideoId?thumb.remove():thumb.attr("id","related_"+thumbId),thumb.removeAttr("data-toggle").removeAttr("data-target"),thumb.removeClass("fd-thumb"),thumb.find(".fd-thumb-description").remove(),thumb.find(".fd-show-more").remove(),$fdVideoLength.remove(),$fdThumbDetails.append(newVideoLength),$fdThumbDetails.find(".fd-video-length").html(videoLength)}),directions.find(".fd-vidmod-playlist-container").append(clone),directions.on("click",".fd-thumb-video-molecule",function(e){if(e.preventDefault(),1==page.container.find(".inline-video").height())self.startStopVideo(e,page);else{var thumbContainer=$(e.target).parents(".fd-thumb-video-molecule"),channelIdx=thumbContainer.data("channel"),videoIdx=thumbContainer.data("index");self.startVideo(page,channelIdx,videoIdx)}})},RelatedVideos.prototype.startVideo=function(page,channelIdx,videoIdx){var self=this,settings=self.settings,container=page.container,components=settings.component,selector=components.filter(function(v,i,t){return"video"==v.name})[0].selector,videoContainer=container.find(selector),playlistId=container.find(".inline-video .fd-vidmod-playlist-container").attr("id");videoContainer.offset().top;"undefined"==typeof channelIdx&&(channelIdx=0),"undefined"==typeof videoIdx&&(videoIdx=0),page.videoManager.playlists[playlistId].loadNewVideo(channelIdx,videoIdx)},RelatedVideos.prototype.scrollPage=function(position){FD.viewports.viewport();(!$pdk||$pdk.isIOS||$pdk.isAndroid)&&$pdk.isIOS&&FD.viewports.isSmallScreen()||setTimeout(function(){$(window).scrollTop(position),setTimeout(function(){$(window).scrollTop(position+1)},100)},100)},RelatedVideos.prototype.startStopVideo=function(e,page){var self=this,videoContainer=(page.container,self.toggleModule(page)),offsetTop=videoContainer.offset().top;if("collapse"==videoContainer.data("toggle"))self.closeModule(page);else{self.scrollPage(offsetTop);var thumbContainer=$(e.target).parents(".fd-thumb-video-molecule"),channelIdx=thumbContainer.data("channel"),videoIdx=thumbContainer.data("index");self.startVideo(page,channelIdx,videoIdx)}},RelatedVideos.prototype.closeModule=function(page){var self=this,settings=self.settings,components=settings.component,selector=components.filter(function(v,i,t){return"video"==v.name})[0].selector,module=page.container.find(selector),offsetTop=module.offset().top;module.height(1),page.videoManager.player.stop(),self.scrollPage(offsetTop)},RelatedVideos.prototype.toggleModule=function(page){var self=this,settings=self.settings,components=settings.component,selector=components.filter(function(v,i,t){return"video"==v.name})[0].selector,module=page.container.find(selector),h=module.height(),toggle=1==h?"expand":"collapse";FD.viewports.viewport();return h>1&&page.videoManager.player.checkPlayer(),(!$pdk||$pdk.isIOS||$pdk.isAndroid)&&$pdk.isIOS&&FD.viewports.isSmallScreen()||(module.data("toggle",toggle),module.height(1==h?"auto":1)),module},RelatedVideos.prototype.getData=function(id){var page=this.page[id];return!!page&&page.data},FD.Page||(FD.Page={}),FD.Page.Video||(FD.Page.Video={}),FD.Page.Video.related=new RelatedVideos,$(function(){var loadRecipe=!0;FD.subscribe("fd.recipe.setcurrentrecipe",function(recipeInfo){if(loadRecipe&&recipeInfo){loadRecipe=!1;var rv=FD.Page.Video.related,$recipe=$('article[data-recipe-id="'+recipeInfo.id+'"]');rv.page[recipeInfo.id]||rv.register($recipe)}})}),$(function(){$(document).on("click",".tpVideoBlocker a",function(e){var a=$(this),href=a.attr("href");"#"==href&&e.preventDefault()})})}(jQuery);