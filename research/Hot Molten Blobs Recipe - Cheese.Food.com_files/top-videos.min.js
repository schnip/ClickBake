!function($){"undefined"==typeof FD.Video&&(FD.Video={});var video=$.extend(!0,FD.Video,{fdPlayerConfig:{player:{autoplay:FD.Video.videoData.autoplay,logLevel:"fatal",containerId:"fd-player",skinUrl:SNI.Config.Video.playerUrl.skin,layoutUrl:SNI.Config.Video.playerUrl.layout,allowfullscreen:!1},social:{enabled:!1},playClickToggle:{enabled:!1},endframe:{endframeCountdown:4}},settings:{template:{playlist:'<section id="{{=it.id}}" class="fd-playlist">{{? it.seoUrl}}<h3 class="fd-playlist-title"><a href="{{=it.seoUrl}}">{{=it.title}}</a></h3>{{??}}<h3 class="fd-playlist-title">{{=it.title}}</h3>{{?}}</section>',playlistItem:'<div id="{{=it.parentId}}_{{=it.cmsid}}" class="fd-thumb fd-thumb-video-molecule"><div class="fd-img-wrap fd-thumb-video"><div class="inner-wrapper"><div class="img-overlay">&nbsp;</div><img data-src="{{=it.imageUrl854x480}}" alt="{{=it.title}}"></div><div class="fd-play-icon"><i class="icon-fdc-play"></i></div></div><div class="fd-thumb-details"><h4 class="fd-thumb-title">{{=it.title}} <span class="fd-video-length">({{=it.duration}})</span></h4><a class="fd-show-more" href="#">More</a><div class="fd-thumb-description"><p>{{=it.description}}</p><div class="fd-site-tools"><dl class="util"><dt class="share-networks"><a class="social-share" data-network="pinterest" data-video-share="true" title="Share on Pinterest"><i class="icon-fdc-pinterest"></i></a> <a class="social-share" data-network="facebook" data-video-share="true" title="Share on Facebook"><i class="icon-fdc-facebook"></i></a> <a class="social-share" data-network="twitter" data-video-share="true" title="Share on Twitter"><i class="icon-fdc-twitter"></i></a> <a class="social-share" data-network="gplus" data-video-share="true" title="Share on Google+"><i class="icon-fdc-google"></i></a> </dt></dl></div></div></div></div>',button:'<button type="button" class="btn btn-default {{=it.css}}">{{=it.text}}</button>'},selector:{breadcrumb:".active-breadcrumb-title",heading:".fd-page-header h1",playlist:{container:".fd-playlist-container",dropdown:".fd-playlist-dropdown .fd-dropdown__select",thumb:{container:".fd-thumb-video-molecule",description:".fd-thumb-description"},button:{more:".fd-show-more",moreThumbs:".btn-see-more-videos",all:".btn-see-all-videos"}},video:{active:{title:".fd-active-video-title",length:".fd-active-video-info .fd-video-length",description:".fd-active-video-description"}}},data:{button:{more:{css:"fd-show-more",text:"More"},moreThumbs:{css:"btn-see-more-videos",text:"More"},all:{css:"btn-see-more-videos",text:"See All Videos"}}},events:{videoLoaded:"fd.video.library.loaded",playListAdded:"fd.video.playlist.added",currentVideoChanged:"fd.video.playlist.currentvideochanged",api:{player:{onLoad:"OnLoadReleaseUrl",onSet:"OnSetReleaseUrl"}}}},init:function(){var self=this,template=self.settings.template;self.playerConfig=$.extend(!0,{},FD.Video.fdPlayerConfig,FD.Video.videoData),self.Player=new SNI.Video.Player(self.playerConfig),self.renderPlaylist=doT.template(template.playlist),self.renderPlaylistItem=doT.template(template.playlistItem),self.renderButton=doT.template(template.button),$(function(){self.renderTemplates(),self.setUpDomEvents(),self.checkPlayer(),self.subscribeToPlayerEvents(),FD.scrollTracker&&FD.subscribe(FD.scrollTracker.eventName,function(){self.lazyLoadThumbnails()})})},checkPlayer:function(){var self=this;self.Player||(self.Player=new SNI.Video.Player(FD.Video.fdPlayerConfig))},reset:function(videoModal){var self=this;$(self.fdPlayerConfig.player.containerId).empty().removeAttr("class"),delete SNI.Video.Players["fd-player"]},renderTemplates:function(){var $playlistElement,$playlistItemElement,self=this,settings=this.settings,selector=settings.selector,playlist=selector.playlist,video=selector.video,activeVideo=video.active,$fdPlaylistContainer=$(playlist.container),dataExists=($(activeVideo.title),$(activeVideo.length),$(activeVideo.description),$(selector.heading),!!self.playerConfig&&!!self.playerConfig.channels);dataExists&&$.each(self.playerConfig.channels,function(channelIndex,channelItem){$playlistElement=$(self.renderPlaylist(channelItem)),$playlistElement.attr("data-index",channelIndex),$.each(channelItem.videos,function(videoIndex,videoItem){$playlistItemElement=$(self.renderPlaylistItem(videoItem)),$playlistItemElement.attr("data-index",videoIndex),$playlistItemElement.attr("data-channel",channelIndex),$playlistElement.append($playlistItemElement)}),$playlistElement.append($(self.renderButton(settings.data.button.moreThumbs))),$fdPlaylistContainer.append($playlistElement),FD.publish(self.settings.events.playListAdded,[{playlistContainer:$fdPlaylistContainer}])})},setUpDomEvents:function(){var self=this,settings=this.settings,selector=settings.selector,playlist=selector.playlist,thumb=playlist.thumb,button=playlist.button,context=selector.playlist.container+" ",$playlistDropdown=$(playlist.dropdown);$(document).on("click",context+thumb.container,function(e){var channelIdx=$(this).data("channel"),videoIdx=$(this).data("index");self.checkPlayer();var target=$(e.target),noModal=target.data("noModal");return noModal?!1:(self.currentVideo={channel:channelIdx,video:videoIdx},void self.loadNewVideo(channelIdx,videoIdx))}),$(document).on("click",context+button.more,function(event){event.preventDefault(),$(this).fadeOut("slow"),$(this).siblings(selector).slideDown("slow"),event.stopPropagation()}),$(document).on("click",context+button.moreThumbs,function(){$(this).siblings(context+thumb.container).fadeIn(),$(this).hide()}),$(document).on("click",button.all,function(){window.location.href=$(this).data("base-url")+"/videos/all-videos-20"}),$playlistDropdown.on("change",function(event){event.preventDefault(),window.location.href=$(this).val()})},subscribeToPlayerEvents:function(){var self=this,apiEvents=self.settings.events.api.player,fdPlayer=self.Player,updateVideoPanel=self.updateVideoPanel.bind(self),highlightActiveVideo=self.highlightActiveVideo.bind(self),updateBreadcrumb=self.updateBreadcrumb.bind(self);fdPlayer.subscribe(apiEvents.onLoad,updateVideoPanel),fdPlayer.subscribe(apiEvents.onSet,updateVideoPanel),fdPlayer.subscribe(apiEvents.onLoad,highlightActiveVideo),fdPlayer.subscribe(apiEvents.onSet,highlightActiveVideo),"VIDEO"===FD.Page.type&&(fdPlayer.subscribe(apiEvents.onLoad,updateBreadcrumb),fdPlayer.subscribe(apiEvents.onSet,updateBreadcrumb))},updateVideoPanel:function(){var self=this,fdPlayer=self.Player,settings=this.settings,selector=settings.selector,video=(selector.playlist,selector.video),activeVideo=video.active;if(fdPlayer.currentVideo){var currentVideo=fdPlayer.currentVideo,videoLength=currentVideo.duration,$fdActiveVideoTitle=$(activeVideo.title),$fdActiveVideoLength=$(activeVideo.length),$fdActiveVideoDescription=$(activeVideo.description);$fdActiveVideoTitle.text(currentVideo.title),$fdActiveVideoLength.html("("+videoLength+")"),$fdActiveVideoDescription.html(currentVideo.description),FD.publish(self.settings.events.currentVideoChanged,[self.Player]);var pageUrl=new FD.Url,vidUrl=new FD.Url(currentVideo.seoUrl),pageType=FD.Page.type;("PLAYLIST"===pageType||"VIDEO"===pageType||"PLAYLIST-VIDEO"===pageType)&&($.extend(!0,vidUrl.querystring.data,pageUrl.querystring.data||{}),FD.History.replace({},FD.Page.title(),vidUrl.toString()))}},updateBreadcrumb:function(){var self=this,fdPlayer=self.Player,$breadcrumbTitle=$(self.settings.selector.breadcrumb);$breadcrumbTitle.text(fdPlayer.currentVideo.title)},highlightActiveVideo:function(){var self=this,fdPlayer=self.Player,currentVideo=fdPlayer.currentVideo,$currentThumbnail=$("#"+currentVideo.parentId+"_"+currentVideo.cmsid);$(".now-playing").removeClass("now-playing"),$currentThumbnail.addClass("now-playing"),$currentThumbnail.is(":visible")||$currentThumbnail.siblings(".btn-see-more-videos").trigger("click")},loadNewVideo:function(channelIndex,videoIndex){var self=this,fdPlayer=this.Player;fdPlayer.previousVideo=fdPlayer.currentVideo,setTimeout(function(){$pdk.controller.hidePlayerCard("forms",null,[fdPlayer.pdk.scopes]),fdPlayer.setCurrentChannel(channelIndex),fdPlayer.play(videoIndex),self.updateVideoPanel(),$pdk.controller.pause(!1,[fdPlayer.pdk.scopes])},100)},lazyLoadThumbnails:function(offset){var self=this,pageHeight=(self.settings.selector,FD.Page.viewport().height),scrollOffset=offset||300,topPos=$(".fd-playlist-container").offset().top;$(".fd-thumb-video img[data-src]:not(img[src])").each(function(){var img=$(this),scrollPos=$(window).scrollTop(),scrollPosWithOutset=scrollPos+scrollOffset,src=img.attr("data-src");FD.subscribe("fd.lazyload.error",function(){var args=arguments;args.length&&args[0]&&args[0].length&&args[0].remove()}),img.on("error",function(){log(img)}),(pageHeight>topPos-scrollPosWithOutset&&topPos-scrollPosWithOutset>=0||pageHeight>topPos-(scrollPos-200)&&topPos-(scrollPos-200)>=0||scrollPos>topPos)&&(log("lazy load img ("+scrollOffset+"): "+src),img.attr("src",src))})}});$(function(){video.init()})}(jQuery),function($){$.extend(!0,FD.Video,{events:{topVideos:{showModal:"fd.video.module.showmodal",hideModal:"fd.video.module.hidemodal"}}});var module=FD.Video.Module={events:{stream:{recipe:{next:"fd.recipe.setcurrentrecipe"}}},cloneTopVideos:function(recipeId){var orig=$(".video-module").first(),firstRecipe=orig.parents("article[data-recipe-id]"),currentRecipe=$('article[data-recipe-id="'+recipeId+'"]'),alreadyLoaded=!!currentRecipe.find(".fd-playlist-container").length,last=currentRecipe.find(".video-module"),clone=orig.find(".fd-playlist-container").clone(!0),cloneTools=orig.find(".promo-tools").clone(!0);firstRecipe.data("recipeId")==recipeId&&alreadyLoaded||(clone.find("[id]").each(function(){var el=$(this),id=el.attr("id")+"_"+recipeId;el.attr("id",id)}),last.empty().append(clone).append(cloneTools))}};FD.subscribe(module.events.stream.recipe.next,function(recipeInfo){module.cloneTopVideos(recipeInfo.id)}),FD.subscribe(FD.Video.settings.events.playListAdded,function(data){$(".btn-see-more-videos").is(":visible")||$(".btn-see-all-videos").show(),$(document).off("click",".btn-see-more-videos").on("click",".btn-see-more-videos",function(event){$(this).parents("article").find(".fd-playlist-container").siblings(".promo-tools").find(".btn-see-all-videos").fadeIn()}),$(".top-videos-playlist-link").attr("href",FD.Video.videoData.channels[0].seoUrl);var playlistContainerId=data.playlistContainer.attr("id");if(data&&data.playlistContainer&&(!playlistContainerId||playlistContainerId&&!playlistContainerId.contains("vidmod"))){var container=data.playlistContainer;container.find(FD.Video.settings.selector.playlist.button.more),container.parents(".promo-module").find(".promo-tools"),FD.viewports.viewport();$(".now-playing").removeClass("now-playing");var thumbs=container.find(".fd-thumb-video-molecule").find(".fd-show-more, .social-share, .social-share i").each(function(){$(this).data("noModal",!0)}).end();(!$pdk||$pdk.isIOS||$pdk.isAndroid)&&$pdk.isIOS&&FD.viewports.isSmallScreen()||thumbs.attr("data-toggle","modal").attr("data-target","#topVideosModal");var videoModule=$(".video-module").first();$("#topVideosModal").outerHtml();videoModule.on("shown.bs.modal","#topVideosModal",function(e){FD.publish(FD.Video.events.topVideos.showModal)}).on("hide.bs.modal","#topVideosModal",function(e){FD.Video.Player.currentVideo=null,$pdk.controller.pause(!0,["fd-player"]),FD.Video.Player.modules&&FD.Video.Player.modules.endframe&&FD.Video.Player.modules.endframe.resetCountdown(),$(".now-playing").removeClass("now-playing"),FD.publish(FD.Video.events.topVideos.hideModal)}).on("hidden.bs.modal","#topVideosModal",function(){}),FD.subscribe("killVideoModal",function(vm){return $("body").removeClass("modal-open"),FD.Video.reset(),!1}),setTimeout(function(){$("#topVideosModal").trigger("hide.bs.modal")},500)}}),FD.subscribe(FD.Video.events.topVideos.showModal,function(player){var params={type:"TYPE",cat:"CategoryDspName",subcat:"SctnDspName",siteTier:"Site Tier"},originalParams={pageType:FD.Page.type,categoryDspName:mdManager.getParameter(params.cat),sctnDspName:mdManager.getParameter(params.subcat)};mdManager.setParameter(params.type,"VIDEO_OVERLAY"),mdManager.setParameter(params.cat,"Videos"),mdManager.setParameter(params.subcat,"RECIPE"),mdManager.setParameter(params.type,originalParams.pageType),mdManager.setParameter(params.cat,originalParams.categoryDspName),mdManager.setParameter(params.subcat,originalParams.sctnDspName)})}(jQuery);