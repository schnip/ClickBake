log("Recipe Box JS"),function($){function isErrorStatus(status){return status&&status.toLowerCase().contains("error")}var recipebox={RecipeBox:{options:{urls:{baseUrl:FD.Config.RecipeBoxApiURL,wrapperUrl:FD.Config.RecipeBoxWrapperURL,getFolders:"/api/fdc/listFolders",isInAFolder:"/api/isSaved",isInAGroceryList:"/api/fdc/inShoppingList",manageGroceryList:"/api/shoppingLists",createFolder:"/api/userRecipes",addToFolder:"/api/userRecipes"},container:""},actions:{getFolders:function(options,recipeId,callback){$.ajax({url:options.urls.wrapperUrl,type:"GET",dataType:"json",cache:!1,data:{api:options.urls.getFolders,assetId:recipeId,json:"true"},xhrFields:{withCredentials:!0},complete:function(request,textStatus){request&&!isErrorStatus(textStatus)&&callback.call(this,request.responseJSON)}})},addToGroceryList:function(options,recipeId){FD.RecipeBox.actions.addToFolder(options,recipeId,0,function(response){FD.publish("fd.recipe-box.folders.add.success"),$.ajax({url:options.urls.wrapperUrl,type:"GET",dataType:"xml",cache:!1,data:{api:options.urls.manageGroceryList,json:"true",action:"add",recipeId:recipeId},xhrFields:{withCredentials:!0},complete:function(){FD.publish("fd.recipe-box.grocery-list.add.success",[recipeId])}})})},removeFromGroceryList:function(options,recipeId){$.ajax({url:options.urls.wrapperUrl,type:"GET",dataType:"xml",cache:!1,data:{api:options.urls.manageGroceryList,json:"true",action:"remove",recipeId:recipeId},xhrFields:{withCredentials:!0},complete:function(){FD.publish("fd.recipe-box.grocery-list.remove.success",[recipeId])}})},addFolder:function(options,recipeId,folderName,callback){log("   folder name: "+folderName+" -> RecipeId: "+recipeId),$.ajax({url:options.urls.wrapperUrl,type:"GET",dataType:"json",cache:!1,xhrFields:{withCredentials:!0},data:{api:options.urls.createFolder,json:"true",action:"add",folderTitle:folderName,folderNote:"",id:recipeId},complete:function(request,textStatus){request&&!isErrorStatus(textStatus)&&callback.call(this,request.responseJSON)}})},addToFolder:function(options,recipeId,folderId,callback){$.ajax({url:options.urls.wrapperUrl,type:"GET",dataType:"json",cache:!1,xhrFields:{withCredentials:!0},data:{api:options.urls.addToFolder,action:"add",json:"true",folderId:folderId,id:recipeId},complete:function(request,textStatus){request&&!isErrorStatus(textStatus)&&callback.call(this,request.responseJSON)}})},isInGroceryList:function(options,recipeId,callback){$.ajax({url:options.urls.wrapperUrl,type:"GET",dataType:"xml",cache:!1,data:{api:options.urls.isInAGroceryList,json:"true",id:recipeId},xhrFields:{withCredentials:!0},complete:function(request,textStatus){request&&!isErrorStatus(textStatus)&&callback.call(this,JSON.parse(request.responseText))}})},isInAFolder:function(options,recipeId,callback){$.ajax({url:options.urls.wrapperUrl,type:"GET",cache:!1,data:{api:options.urls.isInAFolder,id:recipeId,json:"true"},xhrFields:{withCredentials:!0},complete:function(request,textStatus){request&&!isErrorStatus(textStatus)&&callback.call(this,JSON.parse(request.responseText))}})}},display:{hidePending:function(){var container=$("#modal_recipebox .modal-dialog .modal-body .loading");container.hide()},showPending:function(){var container=$("#modal_recipebox .modal-dialog .modal-body .loading");container.show()},clearFolderList:function(){var container=$("#modal_recipebox .modal-dialog .modal-body .list-group");container.empty(),container.hide(),FD.RecipeBox.display.showPending()},setRecipeId:function(recipeId){var button=$("#modal_recipebox .modal-dialog .modal-body .recipe-box-add-new-folder");button.data("recipe-id",recipeId)},showFolderList:function(options,recipeId){var container=$("#modal_recipebox .modal-dialog .modal-body .list-group");FD.RecipeBox.display.clearFolderList(),FD.RecipeBox.actions.getFolders(options,recipeId,function(result){log(result);var folders=result.folders,isInAFolder=!1;$.each(folders,function(key,folder){folder.inFolder?(container.append('<a href="#" class="list-group-item recipe-box-in-folder" data-folder-id="'+folder._id+'" data-folder-url="'+folder.url+'"><i class="icon-fdc-check"></i> '+folder.title+"</a>"),isInAFolder=!0):container.append('<a href="#" class="list-group-item recipe-box-not-in-folder" data-folder-id="'+folder._id+'" data-recipe-id="'+recipeId+'" data-folder-url="'+folder.url+'">'+folder.title+"</a>")}),isInAFolder?(container.prepend('<a href="#" class="list-group-item recipe-box-in-folder" data-folder-id="0" data-recipe-id="'+recipeId+'" data-folder-url="'+FD.RecipeBox.options.urls.baseUrl+'"><i class="icon-fdc-check"></i> All</a>'),FD.publish("fd.recipe-box.folders.in-a-folder.true",[recipeId]),FD.RecipeBox.display.hidePending(),container.show(),FD.RecipeBox.display.setFolderClickHandler()):FD.RecipeBox.actions.isInAFolder(FD.RecipeBox.options,recipeId,function(response){response.mrb.alreadySaved?(container.prepend('<a href="#" class="list-group-item recipe-box-in-folder" data-recipe-id="'+recipeId+'" data-folder-id="0" data-folder-url="'+FD.RecipeBox.options.urls.baseUrl+'"><i class="icon-fdc-check"></i> All</a>'),FD.publish("fd.recipe-box.folders.in-a-folder.true",[recipeId])):container.prepend('<a href="#" class="list-group-item recipe-box-not-in-folder" data-recipe-id="'+recipeId+'" data-folder-id="0" data-folder-url="">All</a>'),FD.RecipeBox.display.hidePending(),container.show(),FD.RecipeBox.display.setFolderClickHandler()}),FD.publish("fd.recipe-box.private-note.show",[result.userNote,recipeId])})},addFolder:function(options,recipeId,folderName){if(""==folderName.trim())return log("Folder Name is Empty"),!1;var container=$("#modal_recipebox .modal-dialog .modal-body .list-group");container.scrollTop(0),log("   folder name: "+folderName+" -> RecipeId: "+recipeId);var newFolderElement='<a href="#" class="list-group-item recipe-box-pending-folder" data-folder-id="{{folder-id}}" data-folder-url="{{folder-url}}"><i class="icon-fdc-loading fa-spin"></i> Saving...</a>';container.find("a:first").after(newFolderElement),FD.RecipeBox.actions.addFolder(options,recipeId,folderName,function(response){"fail"!=response.mrb.response.status&&FD.RecipeBox.actions.getFolders(options,recipeId,function(result){var folderUrl,folderId;$.each(result.folders,function(key,value){return response.mrb.dataSet.folder.id===value._id?(folderId=value._id,folderUrl=value.url,!1):void 0});var newFolderElement=container.find(".recipe-box-pending-folder"),newFolderReplacement='<a href="#" class="list-group-item recipe-box-in-folder" data-folder-id="'+folderId+'" data-folder-url="'+folderUrl+'"><i class="icon-fdc-check"></i> '+folderName+" - View Folder</a>";newFolderElement.replaceWith(newFolderReplacement),FD.RecipeBox.display.setFolderClickHandler(),FD.publish("fd.recipe-box.folders.add.success",[recipeId])})})},addToFolder:function(options,recipeId,folderId,el){var folderUrl=(el.html(),el.data("folder-url"));el.html('<i class="icon-fdc-loading fa-spin"></i> Saving...'),FD.RecipeBox.actions.addToFolder(options,recipeId,folderId,function(response){var allFolder=response.mrb.dataSet.allRecipes;if(allFolder)el.replaceWith('<a href="#" class="list-group-item recipe-box-in-folder" data-folder-id="0" data-folder-url="'+FD.RecipeBox.options.urls.baseUrl+'"><i class="icon-fdc-check"></i> All - View Folder</a>');else{var folder=response.mrb.dataSet.folder;el.replaceWith('<a href="#" class="list-group-item recipe-box-in-folder" data-folder-id="'+folder.id+'" data-folder-url="'+folderUrl+'"><i class="icon-fdc-check"></i> '+folder.title+" - View Folder</a>"),FD.RecipeBox.display.setAllFolderSelected()}FD.RecipeBox.display.setFolderClickHandler(),FD.publish("fd.recipe-box.folders.add.success",[recipeId])})},setAllFolderSelected:function(){var container=$("#modal_recipebox .modal-dialog .modal-body .list-group a");0==container.first().find("i").size()&&container.first().prepend('<i class="icon-fdc-check"></i> ')},setFolderClickHandler:function(){$("#modal_recipebox .list-group .recipe-box-in-folder").off("click"),$("#modal_recipebox .list-group .recipe-box-not-in-folder").off("click"),$("#modal_recipebox .list-group .recipe-box-in-folder").on("click",function(e){var el=$(e.currentTarget);log("Open folder: "+el.data("folder-url")),window.location=el.data("folder-url")}),$("#modal_recipebox .list-group .recipe-box-not-in-folder").on("click",function(e){var el=$(e.currentTarget);return log("Recipe Id -> "+el.data("recipe-id")+" Add to folder: "+el.data("folder-id")),FD.RecipeBox.display.addToFolder(FD.RecipeBox.options,el.data("recipe-id"),el.data("folder-id"),el),!1})},isInTheGroceryList:function(recipeId){FD.RecipeBox.actions.isInGroceryList(FD.RecipeBox.options,recipeId,function(response){response.data[recipeId].inShoppingList&&FD.publish("fd.recipe-box.grocery-list.add.success",[recipeId])})},isInAFolder:function(recipeId){FD.RecipeBox.actions.isInAFolder(FD.RecipeBox.options,recipeId,function(response){"undefined"!=typeof response&&response.mrb.alreadySaved&&FD.publish("fd.recipe-box.folders.add.success",[recipeId])})},getPrivateNote:function(recipeId){FD.RecipeBox.actions.getFolders(FD.RecipeBox.options,recipeId,function(response){"undefined"!=typeof response&&null!==response&&""!=response.userNote&&FD.publish("fd.recipe-box.private-note.show",[response.userNote,recipeId])})}}}};"undefined"==typeof FD&&(FD={}),FD=$.extend(!0,FD,recipebox),$(function(){log("...DOM Ready (Recipe Box JS"),FD.subscribe("fd.recipe-box.folders.show",function(el){log("open recipebox for: "+$(el).data("recipe-id")),FD.RecipeBox.display.clearFolderList(),FD.RecipeBox.display.setRecipeId($(el).data("recipe-id")),$("#modal_recipebox").modal("show"),FD.RecipeBox.display.showFolderList(FD.RecipeBox.options,$(el).data("recipe-id"))}),FD.subscribe("fd.recipe-box.grocery-list.add",function(el){log("save to grocery list for: "+$(el).data("recipe-id")),FD.RecipeBox.actions.addToGroceryList(FD.RecipeBox.options,$(el).data("recipe-id"))}),FD.subscribe("fd.recipe-box.grocery-list.remove",function(el){log("save to grocery list for: "+$(el).data("recipe-id")),FD.RecipeBox.actions.removeFromGroceryList(FD.RecipeBox.options,$(el).data("recipe-id"))}),$(".recipe-box-add-new-folder").on("click",function(e){log("recipe box: add new folder...");var el=$(e.currentTarget),recipeId=el.data("recipe-id"),folderNameElement=$("."+el.data("folder-name-class"));FD.RecipeBox.display.addFolder(FD.RecipeBox.options,recipeId,folderNameElement.val()),folderNameElement.val("")}),$("#modal_recipebox .folder-name").keypress(function(e){return 13==e.which?($("#modal_recipebox .recipe-box-add-new-folder").click(),!1):void 0})})}(jQuery);